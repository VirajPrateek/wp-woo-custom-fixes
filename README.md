# WooCommerce Custom Fixes

A collection of PHP fixes for WooCommerce integrations on WordPress, enhancing event tracking with tools like GTM4WP and Klaviyo.

## Available Fixes

| File Name                     | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Why Required                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | What It Does                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | How It Works                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Example DataLayer Push                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| ----------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `custom_purchase_datalayer.php` | Custom PHP fix designed to ensure reliable purchase event tracking for GA4 when using GTM4WP and potentially other analytics platforms. It addresses scenarios where the standard WooCommerce hook might fail due to conflicts.                                                                                                                                                                                                                            | The WooCommerce `woocommerce_thankyou` hook sometimes fails to trigger on the order received ("thank you") page because of conflicts with other plugins or theme customizations. This prevents accurate GA4 purchase event tracking via GTM4WP. Renaming to `custom_purchase` avoids conflicts, and ensuring `item_id` is an integer aligns with GTM4WP.                                                                                                                                                                                             | Pushes a `custom_purchase` event to the `DataLayer` for GA4, including comprehensive order details such as currency, value, transaction ID, coupon code (if applicable), discount amount, tax amount, shipping cost, and an array of purchased items with their details.                                                                                                                                                                                                                                      | 1. Uses the `woocommerce_thankyou` hook as the primary trigger. <br> 2. Has a fallback on `wp_footer` with `is_checkout()` and `$_GET['order-received']` check for reliability. <br> 3. Outputs `<script async>` for non-blocking execution. <br> 4. Follows Klaviyo-style coding (strict types, single quotes, no trailing commas). <br> 5. Omits the `coupon` field if it's empty and ensures `item_id` is an integer.                                                                                                                                                                                                                                                                                                                                                                                                                    | `javascript\nwindow.dataLayer.push({\n    'event': 'custom_purchase',\n    'ecommerce': {\n        'currency': 'USD',\n        'value': 199.00,\n        'transaction_id': '12345',\n        'items': [{\n            'item_id': 83,\n            'item_name': 'Emotiv Flex Cap',\n            /* ... other item details */\n        }]\n    }\n});\n` |

## License

MIT License. See [LICENSE](LICENSE) for details.
